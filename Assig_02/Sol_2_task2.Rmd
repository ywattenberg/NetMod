---
title: "Assignment 2"
author: "Huang Yingshan, Kahlbacher Fabian, Wattenberg Yannick, Aggeler Samuel"
date: "10/11/2021"
output: html_document
---




# Task 2
```{r}
lawyeradvice <- as.matrix(read.csv("data/lawyeradvice.csv", header=FALSE))
lawyeradvice <- lawyeradvice[2:37, 2:37]
colnames(lawyeradvice) <- 1:36
rownames(lawyeradvice) <- 1:36

lawyerattr <- read.csv("data/lawyerattr.csv", header=TRUE)
```

## 1)
```{r}
#library(sna)
library(network) 
library(ergm)
```

```{r}
netw <- network(lawyeradvice, directed=TRUE)
netw %v% "gender" <- lawyerattr$gender
netw %v% "office_location" <- lawyerattr$office_location
netw %v% "seniority" <- lawyerattr$seniority
```

```{r}
model_gender <- ergm(netw ~ edges + nodematch('gender'))
summary(model_gender)
```
According to the estimates from the ERGM gender homophily is not statistically significant on the 5% level. Thus, it seems that gender does not influence if there is a tie present. 

```{r}
N1 <- sum(lawyerattr$gender == 1)
N2 <- sum(lawyerattr$gender == 2)

tot_same_gender <- N1*(N1-1) + N2*(N2-1)

idx1 <- which(lawyerattr$gender==1)
idx2 <- which(lawyerattr$gender==2)
same_gender_and_tie <- sum(lawyeradvice[idx1, idx1]) + sum(lawyeradvice[idx2, idx2])

same_gender_and_tie / tot_same_gender
```
The conditional probability of observing a tie between two employees
i and j which have the same gender is `same_gender_and_tie / tot_same_gender`. 

```{r}
theta1 <- 0.0865
p <- exp(theta1)/(1+exp(theta1))
```


## 2)

```{r}
model2 <- ergm(
  netw ~ 
    edges +
    mutual +
    gwesp(decay=0.3,fixed=TRUE) + # caution: against transitivity
    nodematch('office_location') +
    nodematch('gender') +
    nodeicov('seniority') +
    nodeocov('seniority') +
    absdiff('seniority')
)
```

## 3)
```{r}
mcmc.diagnostics(model2, which="plots")
```
The algorithm MCMC converged after 3 iterations. The model diagnostics look good as the attributes 
of the simulated networks have low autocorrelation and are more or less 
normal distributed. 

## 4)
```{r}
model2gof <- gof(model2 ~ odegree + idegree + distance + model)

par(mfrow=c(2,2),mar=c(5, 4, 4, 2))
plot(model2gof)
```
Evaluation of GOF of the specified ERGM model:
Desired property of the GOF plots: The observed values (black) should be centered
in the simulated values. Which means they should be more or less close to the median.

- out degree: The observed values of the out degree are mostly very similar to 
the simulated ones. Except for the spike at the out degree 21/22.  
- in degree: The observed values of the in degree are mostly very similar to 
the simulated ones. Except for the spike at the in degree 2 and the minor 
spikes at 20/22.
- minimum geodesic distance: As the other plots the observed values are similar
to the simulated ones. There is a bigger difference for the proportion of dyads
which have a  minimum geodesic distance of two. 
- model: The observed attributes fit very well with the simulated attributes
from the model.

To summarize, there are some differences between the observed statistics and 
the statistics calculated from the simulated model but in general the model fits
the data well. 


## 5)
```{r}
summary(model2)
```
The following interpretation of individual parameters assumes always that the 
other parameters are held constant.
# on page 81 and following the single paramters are described
- edges: ?????????????????????????????????????????????? adds statistic of amount of edges
- mutual: If a tie is reciprocated 
- gwesp.fixed.0.3 : checks whether there is an indication of transitivity in a three way tie
- nodematch.office_location : counts the number of edges (i,j) for which office(i) == office(j). This is the so called uniform homophily.
- nodematch.gender : counts the number of edges (i,j) for which 
gender(i) == gender(j).
- nodeicov.seniority : covariante for in-edges. This adds a single network statistic equal to the total value of seniority(j) for all edges (i,j)
-nodeocov.seniorty : covariante for out-edges. This adds a single netowrk statistic equal to the total value of seniority(i) for all edges (i,j)
-absdiff.seniority : adds a network statistic equal to the sum of abs(seniority[i] - seniortiy[j])^pow for all edges (i,j)

```{r}
plogis(coef(model2)[['edges']] + coef(model2)[['mutual']])
```
Good tutorial for interpretation.
https://www.r-bloggers.com/2016/05/ergm-tutorial/

```{r}
# ***************************************************************
# ask: what do you want as interpretation just significance, sign, and also log odds?
# ***************************************************************
```



## 6)
```{r}
head(lawyerattr)
```







