---
title: "Assignment 2"
author: "Huang Yingshan, Kahlbacher Fabian, Wattenberg Yannick, Aggeler Samuel"
date: "10/11/2021"
output: html_document
---




# Task 2
```{r}
set.seed(123)
```


```{r}
lawyeradvice <- as.matrix(read.csv("data/lawyeradvice.csv", header=FALSE))
lawyeradvice <- lawyeradvice[2:37, 2:37]
colnames(lawyeradvice) <- 1:36
rownames(lawyeradvice) <- 1:36

lawyerattr <- read.csv("data/lawyerattr.csv", header=TRUE)
```

## 1)
```{r message=FALSE, warning=FALSE}
#library(sna)
library(network) 
library(ergm)
```

```{r}
netw <- network(lawyeradvice, directed=TRUE)
netw %v% "gender" <- lawyerattr$gender
netw %v% "office_location" <- lawyerattr$office_location
netw %v% "seniority" <- lawyerattr$seniority
```

```{r}
model_gender <- ergm(netw ~ edges + nodematch('gender'))
summary(model_gender)
```
According to the estimates from the ERGM gender homophily is not statistically significant on the 5% significance level. Thus, it seems that the probability of a tie (asking for advice) does not change if lawyers are of the same or of different gender. 

```{r}
N1 <- sum(lawyerattr$gender == 1)
N2 <- sum(lawyerattr$gender == 2)

tot_same_gender <- N1*(N1-1) + N2*(N2-1)

idx1 <- which(lawyerattr$gender==1)
idx2 <- which(lawyerattr$gender==2)
same_gender_and_tie <- sum(lawyeradvice[idx1, idx1]) + sum(lawyeradvice[idx2, idx2])

same_gender_and_tie / tot_same_gender
```
The conditional probability of observing a tie between two employees
i and j which have the same gender is `same_gender_and_tie / tot_same_gender`. 

```{r}
# probability of observing a tie
theta1 <- model_gender$coef['edges']
p <- exp(theta1)/(1+exp(theta1))
```
The probability of a tie if we do not condition on same gender of lawyers is `p`. Which is about the same as the conditional probability of a tie if lawyers are from the same gender. This is expected since gender homophily is not significant in the model above. 


## 2)

```{r}
model2 <- ergm(
  netw ~ 
    edges +
    mutual +
    gwesp(decay=0.3,fixed=TRUE) + # caution: against transitivity
    nodematch('office_location') +
    nodematch('gender') +
    nodeocov('seniority') +
    nodeicov('seniority') +
    absdiff('seniority')
)
```

## 3)
```{r}
mcmc.diagnostics(model2, which="plots")
```
The algorithm MCMC converged after 3 iterations. The model diagnostics look good as the attributes (sufficient statistics) of the simulated networks have low autocorrelation and are more or less normally distributed. 

## 4)
```{r}
model2gof <- gof(model2 ~ odegree + idegree + distance + model)

par(mfrow=c(2,2),mar=c(5, 4, 4, 2))
plot(model2gof)
```
Evaluation of GOF of the specified ERGM model:
Desired property of the GOF plots: The observed values (black) should be centered
in the simulated values. Which means they should be more or less close to the median.

- out degree: The observed values of the out degree are mostly very similar to 
the simulated ones. Except for the spike at the out degree 21/22.  
- in degree: The observed values of the in degree are mostly very similar to 
the simulated ones. Except for the spike at the in degree 2 and the minor 
spikes at 20/22.
- minimum geodesic distance: As the other plots the observed values are similar
to the simulated ones. There is a bigger difference for the proportion of dyads
which have a  minimum geodesic distance of two. 
- model: The observed attributes fit very well with the simulated attributes
from the model.

To summarize, there are some differences between the observed statistics and 
the statistics calculated from the simulated model but in general the model fits
the data well. 


## 5)
```{r}
summary(model2)
```
```{r}
# Interpretation: significance, sign, odds
```

The following interpretation of individual parameters assumes always that the 
other parameters are held constant.

- edges: The 'edges' parameter is significantly different from 0 on the 5% significance level. Usually this parameter serves as an intercept and is not interpreted. Right???????????????????

- mutual: The 'mutual' parameter is significantly different from 0 on the 5% significance level. The parameter is positive which indicate that the probability of a tie increases if a tie is reciprocated.  
```{r}
odds <- exp( coef(model2)[['edges']] + coef(model2)[['mutual']] )
```
The odds of a tie that is reciprocating an existing tie is by a factor of `r odds` higher than if the tie is not reciprocating.

- gwesp.fixed.0.3: The 'gwesp.fixed.0.3' parameter is significantly different from 0 on the 5% significance level. The parameter is positive which indicate that the probability of a tie increases if ??? (transitivity increases?). 
```{r}
odds <- exp( coef(model2)[['edges']] + coef(model2)[['gwesp.fixed.0.3']] )
```
odds ...

- nodematch.office_location: The 'nodematch.office_location' parameter is significantly different from 0 on the 5% significance level. The parameter is positive which indicate that the probability of a tie increases if two employees are from the same office. 
```{r}
odds <- exp( coef(model2)[['edges']] + coef(model2)[['nodematch.office_location']] )
```
The odds of a tie between two lawyers which are from the same office is by a factor of `r odds` higher than if they would be from a different office.

- nodematch.gender: The 'nodematch.gender' parameter is not significantly different from 0 on the 5% significance level. Therefore, there is evidence that the probability of a tie does not change if lawyers are of the same or of different gender.

- nodeicov.seniority: The 'nodeocov.seniority' parameter is significantly different from 0 on the 5% significance level. The parameter is negative which indicates that the probability of a tie from lawyer i -> j (i ask j for advice) decreases the more senior the lawyer i is. 
```{r}
odds <- exp( coef(model2)[['edges']] + coef(model2)[['nodeicov.seniority']] )
```
odds ....???

- nodeicov.seniority: The 'nodeocov.seniority' parameter is significantly different from 0 on the 5% significance level. The parameter is positive which indicates that the probability of a tie from lawyer i -> j (i ask j for advice) increases the more senior the lawyer j is. 

odds ....???

- absdiff.seniority : The 'nodeocov.seniority' parameter is significantly different from 0 on the 5% significance level. The parameter is negative which indicates that the probability of a tie between lawyers decreases the more absolute difference they have in seniority.

odds ....???


# on page 81 and following the single paramters are described
- edges: ?????????????????????????????????????????????? adds statistic of amount of edges
- mutual: If a tie is reciprocated 
- gwesp.fixed.0.3 : checks whether there is an indication of transitivity in a three way tie
- nodematch.office_location : counts the number of edges (i,j) for which office(i) == office(j). This is the so called uniform homophily.
- nodematch.gender : counts the number of edges (i,j) for which 
gender(i) == gender(j).
- nodeicov.seniority : covariante for in-edges. This adds a single network statistic equal to the total value of seniority(j) for all edges (i,j)
-nodeocov.seniorty : covariante for out-edges. This adds a single netowrk statistic equal to the total value of seniority(i) for all edges (i,j)
-absdiff.seniority : adds a network statistic equal to the sum of abs(seniority[i] - seniortiy[j])^pow for all edges (i,j)



## 6)
```{r}
head(lawyerattr)
```







